{% extends "shared/layout.html" %}
{% block title %}Kategorie{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-3">
  <div>
    <h1 class="h3 mb-0">Kategorie</h1>
    <small class="text-muted">Správa názvů, skupin a popisů kategorií.</small>
  </div>
  <a class="btn btn-primary shadow-sm" href="{{ url_for('admin.add_category') }}">+ Přidat kategorii</a>
</div>

<div class="card shadow-sm">
  <div class="card-body pb-0">
    <form class="row gy-2 gx-2 align-items-end mb-3" method="get" action="{{ url_for('admin.list_categories') }}">
      <div class="col-12 col-md-6 col-lg-5">
        <label class="form-label small text-muted mb-1" for="q">Hledat</label>
        <input type="text" class="form-control" id="q" name="q" placeholder="Název nebo popis" value="{{ search or '' }}">
      </div>
      <div class="col-12 col-md-4 col-lg-3">
        <label class="form-label small text-muted mb-1" for="group">Skupina</label>
        <select class="form-select" id="group" name="group">
          <option value="">Všechny skupiny</option>
          {% for g in groups %}
          <option value="{{ g }}" {% if g == group_filter %}selected{% endif %}>{{ g }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-12 col-md-2 col-lg-4 d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-grow-1">Filtrovat</button>
        <a class="btn btn-outline-secondary" href="{{ url_for('admin.list_categories') }}">Reset</a>
      </div>
    </form>

    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">Název</th>
            <th scope="col">Skupina</th>
            <th scope="col">Popis</th>
            <th scope="col" class="text-end">Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for c in categories %}
          <tr>
            <td class="fw-semibold text-break">{{ c.name }}</td>
            <td class="text-muted text-break">{{ c.group or "—" }}</td>
            <td class="text-muted text-break">{{ c.description or "" }}</td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group">
                <a class="btn btn-outline-secondary" href="{{ url_for('admin.edit_category', category_id=c.id) }}">Upravit</a>
                <form method="post" action="{{ url_for('admin.delete_category', category_id=c.id) }}" class="d-inline" onsubmit="return confirm('Smazat kategorii?');">
                  <button class="btn btn-outline-danger" type="submit">Smazat</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
          {% if not categories %}
          <tr>
            <td colspan="4" class="text-center text-muted py-4">Žádné kategorie</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between align-items-center px-3 py-3">
      <small class="text-muted">
        Stránka {{ pagination.page }} / {{ pagination.pages or 1 }} &middot;
        {{ pagination.total }} záznamů
      </small>
      <div class="btn-group">
        {% set prev_page = pagination.prev_num if pagination.has_prev else None %}
        {% set next_page = pagination.next_num if pagination.has_next else None %}
        <a class="btn btn-outline-secondary btn-sm {% if not prev_page %}disabled{% endif %}"
           href="{% if prev_page %}{{ url_for('admin.list_categories', q=search, group=group_filter, page=prev_page) }}{% else %}#{% endif %}">Předchozí</a>
        <a class="btn btn-outline-secondary btn-sm {% if not next_page %}disabled{% endif %}"
           href="{% if next_page %}{{ url_for('admin.list_categories', q=search, group=group_filter, page=next_page) }}{% else %}#{% endif %}">Další</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
